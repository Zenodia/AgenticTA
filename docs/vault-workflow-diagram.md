# Vault Workflow Visual Guide

## Quick Reference: Token Types

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VAULT TOKEN TYPES                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OIDC Token (ğŸ‘¤)      â”‚  â”‚ Application Token (ğŸ”) â”‚  â”‚ Root Token(ğŸ‘‘) â”‚
â”‚   (Human Admin)        â”‚  â”‚  (Service Account)     â”‚  â”‚  (Bootstrap)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TTL: 1 hour            â”‚  â”‚ TTL: 30 days           â”‚  â”‚ TTL: Forever   â”‚
â”‚ Role: namespace-admin  â”‚  â”‚ Role: agenticta-policy â”‚  â”‚ Role: root     â”‚
â”‚                        â”‚  â”‚                        â”‚  â”‚                â”‚
â”‚ CAN DO:                â”‚  â”‚ CAN DO:                â”‚  â”‚ CAN DO:        â”‚
â”‚ âœ… Create policies     â”‚  â”‚ âœ… Read secrets        â”‚  â”‚ âœ… Everything  â”‚
â”‚ âœ… Create tokens       â”‚  â”‚ âœ… Write secrets       â”‚  â”‚                â”‚
â”‚ âœ… Enable engines      â”‚  â”‚ âœ… List secrets        â”‚  â”‚ SHOULD DO:     â”‚
â”‚                        â”‚  â”‚                        â”‚  â”‚ âš ï¸  Nothing!   â”‚
â”‚ CANNOT DO:             â”‚  â”‚ CANNOT DO:             â”‚  â”‚ (Revoke it)    â”‚
â”‚ âŒ Read secret data    â”‚  â”‚ âŒ Create policies     â”‚  â”‚                â”‚
â”‚ âŒ Write secret data   â”‚  â”‚ âŒ Create tokens       â”‚  â”‚                â”‚
â”‚                        â”‚  â”‚ âŒ Manage infra        â”‚  â”‚                â”‚
â”‚                        â”‚  â”‚                        â”‚  â”‚                â”‚
â”‚ USE FOR:               â”‚  â”‚ USE FOR:               â”‚  â”‚ USE FOR:       â”‚
â”‚ ğŸ”§ Setup & Admin       â”‚  â”‚ ğŸš€ Production Apps     â”‚  â”‚ ğŸ—ï¸  Init only  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Initial Setup Workflow (One-Time)

```
                        INITIAL VAULT SETUP
                        ===================

    ğŸ‘¤ Administrator                    ğŸ¦ Vault Server
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

         â”‚
         â”‚ 1. Install Vault CLI
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚
         â”‚ 2. vault login -method=oidc -path=oidc-admins role=namespace-admin
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                              Opens browser
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   Login with NVIDIA SSO
         â”‚
         â”‚                              Creates OIDC token
         â”‚                              Role: namespace-admin
         â”‚                              TTL: 1 hour
         â”‚
         â”‚ 3. vault secrets enable kv
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                              Enables secret/
         â”‚                              KV v2 engine
         â”‚
         â”‚ 4. vault policy write
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                              Creates agenticta-
         â”‚                              secrets policy
         â”‚
         â”‚ 5. vault token create
         â”‚    -policy=agenticta-secrets
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                              Creates App Token
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   Returns: hvs.CAESIL...
         â”‚
         â”‚ 6. Save to .env
         â”‚    VAULT_TOKEN=hvs.CAESIL...
         â”‚
         â”‚ 7. vault kv put secret/agenticta/*
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                              Stores secrets:
         â”‚                              - api-keys
         â”‚                              - auth-tokens
         â”‚                              - observability
         â”‚
         â”‚ 8. make vault-check
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   âœ… All secrets OK
         â”‚
         â–¼

    âœ… SETUP COMPLETE
    Ready for development!
```

## Daily Development Workflow

```
                    DAILY DEVELOPMENT WORKFLOW
                    ==========================

    ğŸ‘¨â€ğŸ’» Developer              ğŸ³ Application            ğŸ¦ Vault
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€

         â”‚
         â”‚ 1. source .env.vault-staging
         â”‚    (loads VAULT_TOKEN)
         â”‚
         â”‚ 2. make up-with-vault
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                        Starts container
         â”‚                        Reads VAULT_TOKEN env
         â”‚
         â”‚                        3. Initialize Vault Client
         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                        â”‚                         Authenticates
         â”‚                        â”‚                         with token
         â”‚                        â”‚
         â”‚                        4. Fetch Secrets
         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                        â”‚                         Returns:
         â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  - nvidia_api_key
         â”‚                        â”‚                          - hf_token
         â”‚                        â”‚                          - astra_token
         â”‚                        â”‚                          - etc.
         â”‚                        â”‚
         â”‚                        5. Cache for 1 hour
         â”‚                        â”‚
         â”‚                        6. Application Running
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
         â”‚   App ready on :7860   â”‚
         â”‚                        â”‚
         â”‚ 7. Use application     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º     â”‚
         â”‚                        â”‚
         â”‚                        â”‚  (Every hour)
         â”‚                        â”‚  Refresh cache
         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â”‚                        â”‚
         â”‚                        â”‚  (Every 24 hours)
         â”‚                        â”‚  Renew token
         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â”‚                        â”‚
         â–¼                        â–¼

    âœ… Development continues with automatic secret management
```

## Production Deployment Workflow

```
                    PRODUCTION DEPLOYMENT
                    =====================

    ğŸ”§ Admin            ğŸ“¦ CI/CD           ğŸ³ Production      ğŸ¦ Vault
    â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€

         â”‚
         â”‚ 1. Login to Prod Vault
         â”‚    vault login -method=oidc -path=oidc-admins role=namespace-admin
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚                                                    Switch to
         â”‚                                                    prod namespace
         â”‚
         â”‚ 2. Create Prod Token
         â”‚    vault token create -ttl=2160h
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  hvs.PROD...
         â”‚
         â”‚ 3. Store in CI/CD Secrets
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              Stored as masked
         â”‚              environment variable
         â”‚
         â”‚ 4. Trigger Deployment
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              5. Build Image
         â”‚              â”‚
         â”‚              6. Deploy with VAULT_TOKEN
         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              â”‚                   Starts with prod
         â”‚              â”‚                   VAULT_TOKEN
         â”‚              â”‚
         â”‚              â”‚                   7. Fetch Secrets
         â”‚              â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              â”‚                   â”‚                    Returns
         â”‚              â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  prod secrets
         â”‚              â”‚                   â”‚
         â”‚              â”‚                   8. App Running
         â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   (production)
         â”‚              â”‚
         â”‚              9. Deployment Success
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
         â”‚
         â”‚
         â”‚ [90 days later]
         â”‚
         â”‚ 10. Rotate Token (automated)
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              11. Create New Token
         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  New token
         â”‚              â”‚
         â”‚              12. Rolling Update
         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              â”‚                   Update VAULT_TOKEN
         â”‚              â”‚                   Zero downtime
         â”‚              â”‚
         â”‚              13. Old token revoked
         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
         â”‚              â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
         â”‚   Success    â”‚
         â”‚
         â–¼

    âœ… Production running with rotated tokens
```

## Permission Flow

```
                    VAULT PERMISSION MODEL
                    ======================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Vault Server Structure                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ sys/ (System Backend)                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ policies/          â† OIDC can access              â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ auth/              â† OIDC can access              â”‚    â”‚
â”‚  â”‚  â””â”€â”€ mounts/            â† OIDC can access              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ secret/ (KV v2 Engine)                                  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ metadata/agenticta/                                â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ api-keys       â† OIDC can LIST               â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ auth-tokens    â† OIDC can LIST               â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ observability  â† OIDC can LIST               â”‚    â”‚
â”‚  â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  â””â”€â”€ data/agenticta/                                   â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ api-keys       â† App Token can READ/WRITE    â”‚    â”‚
â”‚  â”‚      â”œâ”€â”€ auth-tokens    â† App Token can READ/WRITE    â”‚    â”‚
â”‚  â”‚      â””â”€â”€ observability  â† App Token can READ/WRITE    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ”‘ Token Permissions:

    OIDC Token (namespace-admin):
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âœ… sys/*                    (manage infrastructure)
    âœ… secret/metadata/*        (list secrets, see versions)
    âŒ secret/data/*            (CANNOT read/write actual secrets)

    Application Token (agenticta-secrets):
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    âŒ sys/*                    (CANNOT manage infrastructure)
    âœ… secret/metadata/agenticta/*  (list own secrets)
    âœ… secret/data/agenticta/*      (read/write own secrets)
    âŒ secret/data/other-app/*      (CANNOT access other apps)
```

## Error Resolution Flow

```
                    TROUBLESHOOTING FLOW
                    ====================

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Error Occursâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ "permission denied"â”‚   â”‚"invalid mount path"â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                         â”‚
              â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check token type   â”‚   â”‚ Add mount_point    â”‚
    â”‚ vault token lookup â”‚   â”‚ parameter          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                         â”‚
              â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Shows namespace-    â”‚   â”‚ mount_point=       â”‚
    â”‚admin? Wrong token! â”‚   â”‚    'secret'        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                         â”‚
              â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Create app token:   â”‚   â”‚ Test again         â”‚
    â”‚vault token create  â”‚   â”‚                    â”‚
    â”‚-policy=agenticta-  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚secrets             â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
              â”‚                         â”‚
              â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   âœ… Fixed!       â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Common Issues Checklist:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â˜‘ VAULT_TOKEN set?                â†’ echo $VAULT_TOKEN
    â˜‘ Using app token (not OIDC)?     â†’ vault token lookup
    â˜‘ Token not expired?               â†’ Check ttl field
    â˜‘ Namespace parameter set?         â†’ In hvac.Client()
    â˜‘ mount_point parameter set?       â†’ In API calls
    â˜‘ Path starts with agenticta/?     â†’ Policy restriction
    â˜‘ Secrets exist in Vault?          â†’ make vault-check
```

## Token Lifecycle

```
                        TOKEN LIFECYCLE
                        ===============

    Day 0: Creation
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    vault token create -policy=agenticta-secrets -ttl=720h
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Token: ACTIVE   â”‚
    â”‚ TTL: 720h (30d) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚
    Day 1-29: Use
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             â”‚
             â”‚  [Application uses token]
             â”‚  â”œâ”€ Read secrets
             â”‚  â”œâ”€ Write secrets
             â”‚  â””â”€ List secrets
             â”‚
             â”‚  [Every 24h: Auto-renewal]
             â”‚  â””â”€ vault token renew (via vault_init.py)
             â”‚     TTL extended back to 720h
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Token: ACTIVE   â”‚
    â”‚ TTL: 695h       â”‚  â† Renewed daily
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚
    Day 30: Expiration Warning
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             â”‚
             â”‚  [TTL < 168h (7 days)]
             â”‚  â””â”€ Alert triggered
             â”‚     "Token expiring soon"
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Token: WARNING  â”‚
    â”‚ TTL: 48h        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚
    Option A: Renew              Option B: Rotate
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
             â”‚                            â”‚
             â”‚                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ vault token     â”‚         â”‚ Create new tokenâ”‚
    â”‚ renew           â”‚         â”‚ Update app      â”‚
    â”‚                 â”‚         â”‚ Revoke old tokenâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                            â”‚
             â–¼                            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ TTL: 720h       â”‚         â”‚ New token activeâ”‚
    â”‚ (Extended)      â”‚         â”‚ Old revoked     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Quick Decision Tree

```
                    "WHICH TOKEN DO I USE?"
                    =======================

                    Start Here
                        â”‚
                        â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ What are you doing?  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚               â”‚
         â–¼              â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Setting  â”‚   â”‚Running  â”‚    â”‚Vault     â”‚
    â”‚up Vault?â”‚   â”‚an app?  â”‚    â”‚bootstrap?â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚              â”‚
         â–¼             â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Use OIDC â”‚   â”‚Use App  â”‚    â”‚Use Root  â”‚
    â”‚Token    â”‚   â”‚Token    â”‚    â”‚(DANGER!) â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚              â”‚
         â”‚             â”‚              â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚                                                        â”‚
    â”‚  vault login -method=oidc     export VAULT_TOKEN=      â”‚
    â”‚  -path=oidc-admins            hvs.CAESIL...            â”‚
    â”‚  role=namespace-admin                                  â”‚
    â”‚                                                        â”‚
    â”‚  Then use for:                Then use for:            â”‚
    â”‚  â€¢ Create policy              â€¢ Read secrets           â”‚
    â”‚  â€¢ Create tokens              â€¢ Write secrets          â”‚
    â”‚  â€¢ Setup infra                â€¢ App runtime            â”‚
    â”‚                                                        â”‚
    â”‚  DON'T use for:               DON'T use for:           â”‚
    â”‚  â€¢ Read secrets               â€¢ Create policies        â”‚
    â”‚  â€¢ Production                 â€¢ Setup infra            â”‚
    â”‚                                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Legend

```
Symbols Used:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¤ = Human user / Administrator
ğŸ” = Application / Service account
ğŸ¦ = Vault server
ğŸ³ = Docker container
ğŸ“¦ = CI/CD system
ğŸ”§ = Administrative action
ğŸš€ = Production deployment
âœ… = Success / Allowed
âŒ = Error / Denied
âš ï¸  = Warning / Caution
```

---

**For full details, see:** [VAULT_DEPLOYMENT_GUIDE.md](VAULT_DEPLOYMENT_GUIDE.md)

